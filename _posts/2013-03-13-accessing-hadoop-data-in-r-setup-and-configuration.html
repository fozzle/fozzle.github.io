---
layout: post
title: Accessing Hadoop Data in R, Setup and Configuration
categories:
- Hadoop
- R
tags:
- Hadoop
- r
- rstudio server
status: publish
type: post
published: true
meta:
  _edit_last: '1'
---

<p>So I think I've got this figured out. I'm running a 2VM Ubuntu Server 12.04.2 "cluster".  Here's how I setup R and Rstudio to allow an end user to run data processing in their browser. This tutorial assumes you are installing Rstudio on the master Namenode server, which has a working Hadoop install. <strong>You will need to install R and (I think) RMR2 for every node in the cluster however, so they can process the jobs you create.</strong></p>

<p><strong>Installing R</strong></p>

<p>You will need to add the <a title="CRAN Mirror List" href="http://cran.r-project.org/mirrors.html">CRAN</a> repository to your sources. Obviously this will vary depending on what system you are using. I'm using Ubuntu.</p>

<pre class="lang:sh decode:true " title="/etc/apt/sources.list"># Append me to /etc/apt/sources.list (or the equivalent)
deb http://&lt;cran mirror location&gt;/bin/linux/ubuntu &lt;ubuntuversionname&gt;/</pre>

<p>And of course, update your package listings and install R.</p>

<pre class="lang:sh decode:true " title="Installing R">sudo apt-get update
sudo apt-get install r-base</pre>

<p><strong>Installing RMR2 Dependencies</strong></p>

<p>Next we need to install dependencies for RMR2. There are a handful. Start up R with sudo to install them site wide.</p>

<pre class="lang:sh decode:true ">sudo R</pre>

<p>Then in the R terminal use the following.</p>

<pre class="lang:default decode:true ">install.packages( c('Rcpp', 'RJSONIO', 'digest', 'functional', 'stringr', 'plyr', 'reshape2'))</pre>
This will take a bit and then you can quit R with <em>q()</em>

<p><strong>Installing RMR2</strong></p>

<p>Download RMR2 from RevolutionAnalytics <a title="RMR2" href="https://github.com/RevolutionAnalytics/rmr2">repository on Github</a>. Using the 2.1.0 tag, but be sure to change it to whatever RMR2 version you will be using.</p>

<pre class="lang:sh decode:true" title="Download RMR, Extract, Install">wget --no-check-certificate https://github.com/RevolutionaryAnalytics/rmr2/archive/tag-2.1.0.tar.gz
tar -xzf tag-2.1.0.tar.gz
cd rmr-tag-2.1.0/build
sudo R CMD INSTALL rmr2_2.1.0.tar.gz</pre>

<p>Make sure that worked by loading up R and using <em>library(rmr2). </em>It should import without error.</p>

<p><strong>Install Rstudio Server</strong></p>

<p>This is very easy. If you added the CRAN repo from before, just...</p>

<pre class="lang:default decode:true" title="RStudio Server Install">sudo apt-get install rstudio-server</pre>

<p><a title="RStudio Server" href="http://www.rstudio.com/ide/docs/server/getting_started">More about RStudio Server installation</a></p>

<p>You will know it's working if you head to <em>&lt;server_address&gt;:8787 </em>and you can login with your system user credentials. However, there is one last step before RMR2 will work nicely with Hadoop.</p>

<p><strong>Edit Renviron to work with Hadoop</strong></p>

<p>Now we just need to make sure RStudio has access to the environment variables needed to use RMR. You will need <strong>HADOOP_CMD</strong> and <strong>HADOOP_STREAMING</strong>. Go to your &lt;<em>R_INSTALL_DIR&gt;/Renviron.site</em> and add the following:</p>

<pre class="lang:default decode:true">HADOOP_CMD=&lt;PATH_TO_HADOOP_COMMAND&gt;
HADOOP_STREAMING=&lt;PATH_TO_HADOOP_CONTRIB_STREAMING_JAR&gt;</pre>

<p>Now if you go to Rstudio at <em>&lt;server_address&gt;:8787, </em>login, and you should be able to run</p>

<pre class="lang:r decode:true ">Sys.getenv("HADOOP_CMD")</pre>

<p>And get back the paths you defined.</p>

<p><strong>See if it all worked!</strong></p>

<p>Point your browser to Rstudio, login, and import the RMR2 library.</p>

<pre class="lang:r decode:true ">library("rmr2")</pre>

<p>Try assigning the contents of a DFS file to a variable...</p>

<pre class="lang:r decode:true " title="Using RMR">df = from.dfs('filepath')</pre>

<p>It may take a while, but on success you should see the contents stored into variable df.</p>

<p><strong>Just the start...</strong></p>

<p>What you do from here is up to you. I recommend consulting the following tutorial to start writing map reduce functions via RMR.</p>

<p><a title="RMR Tutorial" href="https://github.com/RevolutionAnalytics/rmr2/blob/master/docs/tutorial.md">RMR Tutorial</a></p>

<p>Or consult the <a title="RHadoop Wiki" href="https://github.com/RevolutionAnalytics/RHadoop/wiki">RHadoop Wiki</a> for more detailed information.</p>
